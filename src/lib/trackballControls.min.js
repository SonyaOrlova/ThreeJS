THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var c=this,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var o=new THREE.Vector3,n=1,i=s.NONE,a=s.NONE,r=new THREE.Vector3,p=new THREE.Vector2,d=new THREE.Vector2,h=new THREE.Vector3,E=0,m=new THREE.Vector2,u=new THREE.Vector2,l=0,g=0,y=new THREE.Vector2,b=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var v={type:"change"},T={type:"start"},w={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var O,R,j,f,H,N,k,L,C,P,V,A,D=(O=new THREE.Vector2,function(e,t){return O.set((e-c.screen.left)/c.screen.width,(t-c.screen.top)/c.screen.height),O}),M=(R=new THREE.Vector2,function(e,t){return R.set((e-.5*c.screen.width-c.screen.left)/(.5*c.screen.width),(c.screen.height+2*(c.screen.top-t))/c.screen.width),R});function z(e){!1!==c.enabled&&(window.removeEventListener("keydown",z),a===s.NONE&&(e.keyCode!==c.keys[s.ROTATE]||c.noRotate?e.keyCode!==c.keys[s.ZOOM]||c.noZoom?e.keyCode!==c.keys[s.PAN]||c.noPan||(a=s.PAN):a=s.ZOOM:a=s.ROTATE))}function Y(){!1!==c.enabled&&(a=s.NONE,window.addEventListener("keydown",z,!1))}function S(e){if(!1!==c.enabled){if(e.preventDefault(),e.stopPropagation(),i===s.NONE)switch(e.button){case c.mouseButtons.LEFT:i=s.ROTATE;break;case c.mouseButtons.MIDDLE:i=s.ZOOM;break;case c.mouseButtons.RIGHT:i=s.PAN;break;default:i=s.NONE}var t=a!==s.NONE?a:i;t!==s.ROTATE||c.noRotate?t!==s.ZOOM||c.noZoom?t!==s.PAN||c.noPan||(y.copy(D(e.pageX,e.pageY)),b.copy(y)):(m.copy(D(e.pageX,e.pageY)),u.copy(m)):(d.copy(M(e.pageX,e.pageY)),p.copy(d)),document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",x,!1),c.dispatchEvent(T)}}function X(e){if(!1!==c.enabled){e.preventDefault(),e.stopPropagation();var t=a!==s.NONE?a:i;t!==s.ROTATE||c.noRotate?t!==s.ZOOM||c.noZoom?t!==s.PAN||c.noPan||b.copy(D(e.pageX,e.pageY)):u.copy(D(e.pageX,e.pageY)):(p.copy(d),d.copy(M(e.pageX,e.pageY)))}}function x(e){!1!==c.enabled&&(e.preventDefault(),e.stopPropagation(),i=s.NONE,document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",x),c.dispatchEvent(w))}function Z(e){if(!1!==c.enabled&&!0!==c.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:m.y-=.025*e.deltaY;break;case 1:m.y-=.01*e.deltaY;break;default:m.y-=25e-5*e.deltaY}c.dispatchEvent(T),c.dispatchEvent(w)}}function U(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:i=s.TOUCH_ROTATE,d.copy(M(e.touches[0].pageX,e.touches[0].pageY)),p.copy(d);break;default:i=s.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=l=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(D(n,a)),b.copy(y)}c.dispatchEvent(T)}}function _(e){if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p.copy(d),d.copy(M(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(D(n,a))}}function q(e){if(!1!==c.enabled){switch(e.touches.length){case 0:i=s.NONE;break;case 1:i=s.TOUCH_ROTATE,d.copy(M(e.touches[0].pageX,e.touches[0].pageY)),p.copy(d)}c.dispatchEvent(w)}}function F(e){!1!==c.enabled&&e.preventDefault()}this.rotateCamera=(f=new THREE.Vector3,H=new THREE.Quaternion,N=new THREE.Vector3,k=new THREE.Vector3,L=new THREE.Vector3,C=new THREE.Vector3,function(){C.set(d.x-p.x,d.y-p.y,0),(j=C.length())?(r.copy(c.object.position).sub(c.target),N.copy(r).normalize(),k.copy(c.object.up).normalize(),L.crossVectors(k,N).normalize(),k.setLength(d.y-p.y),L.setLength(d.x-p.x),C.copy(k.add(L)),f.crossVectors(C,r).normalize(),j*=c.rotateSpeed,H.setFromAxisAngle(f,j),r.applyQuaternion(H),c.object.up.applyQuaternion(H),h.copy(f),E=j):!c.staticMoving&&E&&(E*=Math.sqrt(1-c.dynamicDampingFactor),r.copy(c.object.position).sub(c.target),H.setFromAxisAngle(h,E),r.applyQuaternion(H),c.object.up.applyQuaternion(H)),p.copy(d)}),this.zoomCamera=function(){var e;i===s.TOUCH_ZOOM_PAN?(e=l/g,l=g,c.object.isPerspectiveCamera?r.multiplyScalar(e):c.object.isOrthographicCamera?(c.object.zoom*=e,c.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(u.y-m.y)*c.zoomSpeed)&&0<e&&(c.object.isPerspectiveCamera?r.multiplyScalar(e):c.object.isOrthographicCamera?(c.object.zoom/=e,c.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),c.staticMoving?m.copy(u):m.y+=(u.y-m.y)*this.dynamicDampingFactor)},this.panCamera=(P=new THREE.Vector2,V=new THREE.Vector3,A=new THREE.Vector3,function(){if(P.copy(b).sub(y),P.lengthSq()){if(c.object.isOrthographicCamera){var e=(c.object.right-c.object.left)/c.object.zoom/c.domElement.clientWidth,t=(c.object.top-c.object.bottom)/c.object.zoom/c.domElement.clientWidth;P.x*=e,P.y*=t}P.multiplyScalar(r.length()*c.panSpeed),A.copy(r).cross(c.object.up).setLength(P.x),A.add(V.copy(c.object.up).setLength(P.y)),c.object.position.add(A),c.target.add(A),c.staticMoving?y.copy(b):y.add(P.subVectors(b,y).multiplyScalar(c.dynamicDampingFactor))}}),this.checkDistances=function(){c.noZoom&&c.noPan||(r.lengthSq()>c.maxDistance*c.maxDistance&&(c.object.position.addVectors(c.target,r.setLength(c.maxDistance)),m.copy(u)),r.lengthSq()<c.minDistance*c.minDistance&&(c.object.position.addVectors(c.target,r.setLength(c.minDistance)),m.copy(u)))},this.update=function(){r.subVectors(c.object.position,c.target),c.noRotate||c.rotateCamera(),c.noZoom||c.zoomCamera(),c.noPan||c.panCamera(),c.object.position.addVectors(c.target,r),c.object.isPerspectiveCamera?(c.checkDistances(),c.object.lookAt(c.target),1e-6<o.distanceToSquared(c.object.position)&&(c.dispatchEvent(v),o.copy(c.object.position))):c.object.isOrthographicCamera?(c.object.lookAt(c.target),(1e-6<o.distanceToSquared(c.object.position)||n!==c.object.zoom)&&(c.dispatchEvent(v),o.copy(c.object.position),n=c.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){i=s.NONE,a=s.NONE,c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.up.copy(c.up0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),r.subVectors(c.object.position,c.target),c.object.lookAt(c.target),c.dispatchEvent(v),o.copy(c.object.position),n=c.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",F,!1),this.domElement.removeEventListener("mousedown",S,!1),this.domElement.removeEventListener("wheel",Z,!1),this.domElement.removeEventListener("touchstart",U,!1),this.domElement.removeEventListener("touchend",q,!1),this.domElement.removeEventListener("touchmove",_,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",z,!1),window.removeEventListener("keyup",Y,!1)},this.domElement.addEventListener("contextmenu",F,!1),this.domElement.addEventListener("mousedown",S,!1),this.domElement.addEventListener("wheel",Z,!1),this.domElement.addEventListener("touchstart",U,!1),this.domElement.addEventListener("touchend",q,!1),this.domElement.addEventListener("touchmove",_,!1),window.addEventListener("keydown",z,!1),window.addEventListener("keyup",Y,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;